import{F as u,P as y,s}from"./loader-BNZq2rkl.js";/* empty css                    */const x=new URLSearchParams(window.location.search),d=x.get("id"),E=document.getElementById("imageuploads"),r=document.getElementById("file-input");async function B(n){return new Promise(i=>{const e=new FileReader;e.readAsDataURL(n),e.onload=a=>{const o=new Image;o.src=a.target.result,o.onload=()=>{const t=document.createElement("canvas"),l=800,c=l/o.width;o.width>l?(t.width=l,t.height=o.height*c):(t.width=o.width,t.height=o.height),t.getContext("2d").drawImage(o,0,0,t.width,t.height),t.toBlob(m=>{i(m)},"image/jpeg",.7)}}})}r.addEventListener("change",()=>{[...r.files].forEach(n=>{const i=document.createElement("div");i.className="relative w-full h-48 ";const e=document.createElement("img"),a=document.createElement("button");a.innerHTML=`<button id='delbtn' class="cursor-pointer relative px-1 -top-47 -right-54 w-8 h-8 bg-white/60 rounded-4xl backdrop-blur-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M3 6h18"></path>
  <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
  <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
  <line x1="10" y1="11" x2="10" y2="17"></line>
  <line x1="14" y1="11" x2="14" y2="17"></line>
</svg></button>`,a.addEventListener("click",()=>{i.remove(),r.value=""}),e.src=URL.createObjectURL(n),e.className="ml-3 h-50 w-full object-cover rounded-lg",i.appendChild(e),i.appendChild(a),E.childElementCount<4&&E.appendChild(i)})});let h=[];const k=document.getElementById("post-btn");k.addEventListener("click",async n=>{n.preventDefault();const i=document.getElementById("title").value,e=document.getElementById("description").value,a=document.getElementById("price").value,o=document.getElementById("details").value,t=document.getElementById("quantity").value,l=r.files;if((!i||!e||!a||l.length==0)&&!d){u("Please fill in Name, Price, and select an Image!");return}try{let c=[];if(l.length>0){y("Optimizing images...");for(const g of l){const C=await B(g),f=`${Date.now()}-${g.name.split(".")[0]}.jpg`,{data:L,error:v}=await s.storage.from("Uploaded_Images").upload(f,g,{contentType:"image/jpeg"});if(v){u("Upload Failed: "+v.message);return}const{data:{publicUrl:I}}=s.storage.from("Uploaded_Images").getPublicUrl(f);c.push(I)}}else c=h;const{data:{user:p}}=await s.auth.getUser();if(!p){u("You must be logged in to post!");return}const m={title:i,price:a,description:e,quantity:t,details:o,image_url:c,seller_id:p.id};d&&(m.id=d);const{error:w}=await s.from("products").upsert(m);if(w)throw w;y("Item posted Successfully");const b=window.location.origin;window.location.href=`${b}/src/marketplace/market-place.html`}catch(c){u(c.message)}});async function U(){if(d){const{data:n}=await s.from("products").select("*").eq("id",d).single();n&&(document.getElementById("title").value=n.title,document.getElementById("price").value=n.price,document.getElementById("description").value=n.description,document.getElementById("details").value=n.details,document.getElementById("quantity").value=n.quantity,h=n.image_url||[],h.forEach(i=>{const e=document.createElement("div");e.className="relative w-full h-48";const a=document.createElement("img"),o=document.getElementById("imageuploads"),t=document.createElement("button");t.innerHTML=`<button id='delbtn' class="cursor-pointer relative px-2 top-2 right-2 w-8 h-8 bg-white/60 rounded-4xl backdrop-blur-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg></button>`,t.addEventListener("click",()=>{e.remove(),r.value=""}),a.src=i,a.className="ml-3 h-50 w-full object-cover rounded-lg",e.appendChild(a),e.appendChild(t),o.childElementCount<4&&o.appendChild(e)}))}}U();
